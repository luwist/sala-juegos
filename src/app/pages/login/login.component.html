<main class="main">
  @if (showError) {
  <app-toast message="{{ messageError }}" />
  }
  <div>
    <h1 class="title">Iniciar Sesion</h1>

    <p-dropdown
      [options]="accounts"
      [(ngModel)]="selectedAccount"
      optionLabel="name"
      name="user"
      (click)="onSelectedAccount()"
      placeholder="Elige tu cuenta"
      class="custom-dropdown"
    >
      <ng-template pTemplate="selectedItem">
        @if (selectedAccount) {
        <div class="user">
          <img src="{{ selectedAccount.pictureUrl }}" class="avatar" />
          <div class="content">
            <p class="username">{{ selectedAccount.username }}</p>
            <p class="role">{{ selectedAccount.role }}</p>
          </div>
        </div>
        }
      </ng-template>
      <ng-template let-user pTemplate="user">
        <div class="user" style="padding: 12px">
          <img src="{{ user.avatar }}" class="avatar" />
          <div class="content">
            <p class="username">{{ user.username }}</p>
            <p class="role">{{ user.role }}</p>
          </div>
        </div>
      </ng-template>
    </p-dropdown>

    <p-divider align="center" type="solid">
      <b>O</b>
    </p-divider>
    <form class="form" (submit)="login($event)" [formGroup]="loginForm">
      <div class="form-field">
        <label class="label">Correo Electronico</label>
        <input placeholder="Correo Electronico" formControlName="email" />
        @if (emailControl.invalid && (emailControl.touched ||
        emailControl.dirty)) { @if (emailControl.hasError('required')) {
        <p class="error">El correo electronico no puede estar vacio</p>
        } @if (emailControl.hasError('email')) {
        <p class="error">Ingrese un correo electronico valido</p>
        } }
      </div>

      <div class="form-field">
        <label class="label">Contrase単a</label>
        <input
          type="password"
          placeholder="Contrase単a"
          formControlName="password"
        />

        @if (passwordControl.invalid && (passwordControl.touched ||
        passwordControl.dirty)) {
        <p class="error">La contrase単a no puede estar vacia</p>
        }
      </div>

      <button
        [disabled]="(loginForm.statusChanges | async) !== 'VALID'"
        class="button-submit"
        type="submit"
      >
        {{ buttonText }}
      </button>

      <p class="create-account">
        多No tienes una cuenta? <a href="/register">Registrate</a>
      </p>
    </form>
  </div>
</main>
